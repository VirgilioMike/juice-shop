name: Security Suite (SAST & DAST)
on: [push, pull_request]

jobs:
  security:
    runs-on: ubuntu-latest
    env:
      ZAP_IMAGE: ghcr.io/zaproxy/zap2docker-stable:2.14.0

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # Aguarda o Juice Shop iniciar
      - name: Esperando o Juice Shop subir
        run: |
          echo "⌛ Esperando o Juice Shop em http://localhost:3000 …"
          for i in $(seq 1 12); do
            if curl --silent --fail http://localhost:3000; then
              echo "✅ Juice Shop está no ar!"
              break
            fi
            sleep 5
          done

      # Puxa a imagem do ZAP já corrigida
      - name: Baixando imagem do ZAP
        run: docker pull $ZAP_IMAGE

      # Adicione outras etapas de análise SAST/DAST conforme necessário
      # Exemplo (substitua pelo seu caso real):
      # - name: Rodando SAST
      #   run: echo "SAST em execução..."

      # - name: Rodando DAST
      #   run: |
      #     docker run --rm \
      #       -v $(pwd):/zap/wrk:rw \
      #       $ZAP_IMAGE zap-baseline.py -t http://localhost:3000

      # Outras etapas conforme sua configuração...
